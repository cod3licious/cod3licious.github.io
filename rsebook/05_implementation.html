<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US" xml:lang="en-US"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.34">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>5&nbsp; Implementation – Clarity-Driven Development of Scientific Software</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./06_from_research_to_production.html" rel="next">
<link href="./04_tools.html" rel="prev">
<link href="./favicon.png" rel="icon" type="image/png">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-c8ad9e5dbd60b7b70b38521ab19b7da4.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-31e51141b8c31bdc536616a43344ac8e.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="style.css">
</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part2.html">Part 2: Writing Code</a></li><li class="breadcrumb-item"><a href="./05_implementation.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Implementation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Clarity-Driven Development of Scientific Software</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 1: Gaining Clarity</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_outcome_why.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Outcome: Why?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_output_what.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Output: What?</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_state_flow_how.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">State &amp; Flow: How?</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./part2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Part 2: Writing Code</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_tools.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tools</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_implementation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Implementation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_from_research_to_production.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">From Research to Production</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./afterword.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Afterword</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#make-a-plan" id="toc-make-a-plan" class="nav-link active" data-scroll-target="#make-a-plan">Make a Plan</a></li>
  <li><a href="#from-concept-to-code" id="toc-from-concept-to-code" class="nav-link" data-scroll-target="#from-concept-to-code">From Concept to Code</a></li>
  <li><a href="#documentation-comments" id="toc-documentation-comments" class="nav-link" data-scroll-target="#documentation-comments">Documentation &amp; Comments</a></li>
  <li><a href="#testing" id="toc-testing" class="nav-link" data-scroll-target="#testing">Testing</a></li>
  <li><a href="#debugging" id="toc-debugging" class="nav-link" data-scroll-target="#debugging">Debugging</a></li>
  <li><a href="#optimizing-performance" id="toc-optimizing-performance" class="nav-link" data-scroll-target="#optimizing-performance">Optimizing Performance</a></li>
  <li><a href="#sec-refactoring" id="toc-sec-refactoring" class="nav-link" data-scroll-target="#sec-refactoring">Refactoring</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./part2.html">Part 2: Writing Code</a></li><li class="breadcrumb-item"><a href="./05_implementation.html"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Implementation</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-implementation" class="quarto-section-identifier"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Implementation</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Armed with the right tools and a solid concept, it’s time to start coding. In this chapter we’ll discuss some practical tips and best practices to ensure your ideas do not only look good on paper.</p>
<section id="make-a-plan" class="level2">
<h2 class="anchored" data-anchor-id="make-a-plan">Make a Plan</h2>
<p>Seeing your software design mapped out in full can feel overwhelming—there’s so much to do! That’s why it’s important to <strong>break the implementation process into small, manageable tasks.</strong> Rather than getting stuck in the details, <strong>start by implementing the full end-to-end flow</strong>. Once that’s in place, you can refine individual models, tweak data processing steps, or make plots prettier.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Minimum Viable Results">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Minimum Viable Results
</div>
</div>
<div class="callout-body-container callout-body">
<p>In product development, there’s a concept called the <strong>Minimum Viable Product (MVP)</strong>. This refers to the simplest version of a product that still provides value to users.</p>
<p>The MVP serves as a prototype to gather feedback on whether the product meets user needs and to identify which features are truly essential. By iterating quickly and testing assumptions, teams can increase the odds of creating a successful product that people will actually pay for. This approach also has motivational benefits. Seeing something functional—even if basic—early on makes it easier to stay engaged. It’s far better than toiling for months without tangible results.</p>
<p>You should apply the same mindset to your research software development by <strong>starting with a script that generates “Minimum Viable Results.”</strong> This means creating a program that produces outputs resembling your final results, like plots or tables, but using placeholder data instead of actual values. For instance:</p>
<ul>
<li>If your goal is to build a prediction model, start with one that simply predicts the mean of the observed data.</li>
<li>If you’re developing a simulation, begin with random outputs, such as a random walk.</li>
</ul>
<p>By starting with Minimum Viable Results, you can <strong>test your code end-to-end</strong> early on, see tangible progress, and <strong>iteratively improve</strong> from there.</p>
<p>This approach also serves as a <strong>“stupid baseline”</strong>—a simple, easy-to-beat reference point for your final method. It’s a sanity check: if your sophisticated model can’t outperform a baseline that always predicts the mean, something’s off.</p>
</div>
</div>
<p>To organize implementation steps and track progress, consider using a <strong>Kanban board</strong>, a tool commonly used in project management. Software like Trello, Notion, or Linear can help you create Kanban boards, where you can describe tasks in more detail (e.g., adding sketches of the plots you want to generate) compared to a simple to-do list.</p>
</section>
<section id="from-concept-to-code" class="level2">
<h2 class="anchored" data-anchor-id="from-concept-to-code">From Concept to Code</h2>
<p>Using your software design from <a href="03_state_flow_how.html" class="quarto-xref"><span>Chapter 3</span></a>, you can now <strong>translate your sketch into a code skeleton</strong>. Start by outlining the functions, place calls to them where needed, and add comments for any steps you’ll figure out later. For example, the design from <a href="03_state_flow_how.html#fig-draw-script" class="quarto-xref">Figure&nbsp;<span>3.14</span></a> could result in the following draft:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># in models/my_model.py</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyModel:</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, param1):</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.param1 <span class="op">=</span> param1</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>, x, y):</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">pass</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> predict(<span class="va">self</span>, x):</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> ...</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> y</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># in data_utils.py</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> preprocess(df):</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> ...</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_data(file_name):</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.read_csv(file_name)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> preprocess(df)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> df</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="co"># in results.py</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_r2(y, y_pred):</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> ...</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r2</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> evaluate_plot(y, y_pred):</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> compute_r2(y, y_pred)</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ... create and save plot ...</span></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> r2</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a><span class="co"># in main.py</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> main(model):</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>    df_train <span class="op">=</span> load_data(<span class="st">"train.csv"</span>)</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>    model.fit(df_train.x, df_train.y)</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>    df_test <span class="op">=</span> load_data(<span class="st">"test.csv"</span>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>    y_pred <span class="op">=</span> model.predict(df_test.x)</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>    r2 <span class="op">=</span> evaluate_plot(df_test.y, y_pred)</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">'__main__'</span>:</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># script is called as `python main.py seed param1 [param2]`</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>    seed, param1, param2 <span class="op">=</span> ...</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>    np.random.seed(seed)</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># </span><span class="al">TODO</span><span class="co">: check which type of model to create (mine or baseline)</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>    model <span class="op">=</span> MyModel(param1)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>    main(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-note callout-titled" title="Order of functions">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Order of functions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Your code files likely include multiple functions, so you’ll need to decide their order from top to bottom. Since scripts typically start with imports (e.g., of libraries like <code>numpy</code>) and end with a <code>main</code> function, personally I prefer to put more general functions (i.e., the ones that are at the lower levels of abstraction in your call hierarchy and that only rely on external dependencies) towards the top of the file. This ensures that, as you read the script from top to bottom, <strong>each function depends only on what was defined before it</strong>. Maintaining this order avoids circular dependencies and encourages you to write reusable, modular functions that serve as building blocks for the code that follows.</p>
</div>
</div>
<section id="fill-in-the-blanks" class="level5">
<h5 class="anchored" data-anchor-id="fill-in-the-blanks">Fill in the Blanks</h5>
<p>Once your skeleton stands, you “only” need to <strong>fill in the details</strong>, which is a lot less intimidating than facing a blank page. Plus, since you started with a thoughtful design, your final program is more likely to be well-structured and easy to understand. Compare this to writing code on the fly, where decisions about functions are often made haphazardly—you’ll appreciate the difference.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Using AI code generators">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Using AI code generators
</div>
</div>
<div class="callout-body-container callout-body">
<p>AI assistants like ChatGPT, Claude, or GitHub Copilot can be helpful tools when writing code, especially at the level of individual functions. However, remember that these tools only reproduce patterns from their training data, which includes both good and bad code. As a result, the code they generate may not always be optimal. For instance, they might use inefficient for-loops instead of more elegant matrix operations. Similarly, support for less popular programming languages may be subpar.<br>
To get better results, consider crafting prompts like: <em>“You are a senior Python developer with 10 years of experience writing efficient, edge-case-aware code. Write a function …”</em></p>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="Think it through!">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Think it through!
</div>
</div>
<div class="callout-body-container callout-body">
<p>It’s essential that you always <strong>understand what your code is doing</strong> (especially if it was written with AI assistance).<br>
Go through your code line by line and consider <strong>what is true at each step</strong>. This will help you spot issues such as conditional statements that are always true or always false and therefore unnecessary and potentially confusing. For example:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>min_value <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> [<span class="dv">10</span>, <span class="dv">100</span>, <span class="dv">1000</span>]:</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> i <span class="op">&gt;</span> min_value:  <span class="co"># always True</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Here, the condition <code>i &gt; min_value</code> is redundant—it will always evaluate to <code>True</code>. It might have made sense in an earlier version of the code when <code>i</code> could be less than <code>min_value</code>, but now it only adds confusion, making a reader think they’re missing something.</p>
<p>While this case is obvious, other instances can be much harder to detect. So to improve your own understanding of the code—and to help others who read it—you should always know what each line does and remove any logic that no longer serves a purpose.</p>
</div>
</div>
</section>
<section id="keep-it-compact" class="level4">
<h4 class="anchored" data-anchor-id="keep-it-compact">Keep It Compact</h4>
<p>When writing code, aim to achieve your goals while using <strong>as little screen space as possible</strong>—this applies to both the number of lines and their length.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Tips to create compact, reusable code">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tips to create compact, reusable code
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><p><strong>Avoid duplication</strong>: Instead of copying and pasting code in multiple places, consolidate it into a reusable function to save lines (DRY principle).</p></li>
<li><p><strong>Prefer ‘deep’ functions</strong>: Avoid extracting very short code fragments (1-2 lines) into a separate function, especially if this function would require many arguments. Such shallow functions with wide interfaces increase complexity without meaningfully reducing line count. Instead, strive for <em>deep functions</em> (spanning multiple lines) with <em>narrow interfaces</em> (e.g., only 1-3 input arguments, i.e., <strong>fewer arguments than the function has lines of code</strong>), which tend to be more general and reusable <span class="citation" data-cites="ousterhout2018philosophy">[<a href="references.html#ref-ousterhout2018philosophy" role="doc-biblioref">8</a>]</span>.</p></li>
<li><p><strong>Address nesting</strong>: If your code becomes overly nested, this can be a sign that parts of the code should be moved into a separate function. This simplifies logic and shortens lines.</p></li>
<li><p><strong>Use guard clauses</strong>: Deeply nested <code>if</code>-statements can make code harder to read. Instead, use guard clauses <span class="citation" data-cites="beck2023tidy">[<a href="references.html#ref-beck2023tidy" role="doc-biblioref">1</a>]</span> to handle preconditions (e.g., checking for wrong user input) early, leaving the “happy path” clear and concise. For example:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> condition:</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> other_condition:</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>        <span class="co"># do something</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> result</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Can be refactored into:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="kw">not</span> condition:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> other_condition:</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="va">None</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># do something</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="cf">return</span> result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>This approach reduces nesting and improves readability.</p></li>
</ul>
</div>
</div>
</section>
</section>
<section id="documentation-comments" class="level2">
<h2 class="anchored" data-anchor-id="documentation-comments">Documentation &amp; Comments</h2>
<p>While you write it, everything seems obvious. However, when revisiting your code a few months later (e.g., to try a different experiment), you’re often left wondering what the heck you were doing. This is especially true when some external constraint (like a library quirk) forced you to create a workaround instead of opting for the straightforward solution. When returning to such code, you might be tempted to replace the awkward implementation with something more elegant, only to rediscover why you chose that approach in the first place. This is where comments can save you some trouble. And they are even more important when collaborating with others who need to understand your code.</p>
<p>We distinguish between documentation and comments: <strong>Documentation</strong> provides the general description of <strong><em>when and how to use your code</em></strong>, such as function docstrings explaining what the function computes, its input arguments, and return values. This is particularly important for open source libraries where you can’t personally explain the code’s purpose and usage to others. <strong>Comments</strong> help developers understand <strong><em>why your code was written in a certain way</em></strong>, like explaining that unintuitive workaround. Additionally, for scientific code, you may also need to document the origin of certain values or equations by referencing the corresponding paper in the comments.</p>
<div class="callout callout-style-default callout-warning callout-titled" title="Code should be self-documenting">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code should be self-documenting
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ideally, your code should be written so clearly that it’s self-explanatory. Comments shouldn’t explain <em>what</em> the code does, only <em>why</em> it does that (when not obvious). <strong>Comments and documentation, like code, need to be maintained</strong>—if you modify code, you need to update the corresponding comments or they become misleading and harmful rather than helpful. Using comments sparingly minimizes the risk of confusing, outdated comments.</p>
<p>Informative variable and function names are essential for self-explanatory code. When you’re tempted to write a comment that summarizes what the following block of code does (e.g., <code># preprocess data</code>), consider <strong>moving these lines into a separate function with an informative name</strong>, especially if they contain significant, reusable logic.</p>
</div>
</div>
<section id="naming-is-hard" class="level4">
<h4 class="anchored" data-anchor-id="naming-is-hard">Naming Is Hard</h4>
<blockquote class="blockquote">
<p><em>There are only two hard things in Computer Science: cache invalidation and naming things.</em><br>
– Phil Karlton<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</blockquote>
<p>Finding informative names for variables, functions, and classes can be challenging, but good names are crucial to make the code easier to understand for you and your collaborators.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Tips for effective naming">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tips for effective naming
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Names should <strong>reveal intent</strong>. Longer names (consisting of multiple words in <code>snake_case</code> or <code>camelCase</code>, depending on the conventions of your chosen programming language) are usually better. However, <strong>stick to domain conventions</strong>—if everyone understands <code>X</code> and <code>y</code> as feature matrix and target vector, use these despite common advice denouncing single letter names.</li>
<li><strong>Be consistent</strong>: similar names should indicate similar things. This makes it easier to <strong>recognize patterns</strong> and extrapolate what you’ve learned about one implementation (e.g., <code>BaselineAModel</code>) to others (e.g., <code>BaselineBModel</code>), which reduces the <strong>mental effort required to understand the code</strong> <span class="citation" data-cites="lilienthal2019sustainable">[<a href="references.html#ref-lilienthal2019sustainable" role="doc-biblioref">6</a>]</span>. On the other hand, if you name two things similarly even though they behave differently, this increases the cognitive load as you need to explicitly memorize this exception.</li>
<li><strong>Avoid reserved keywords</strong> (i.e., words your code editor colors differently, like Python’s <code>input</code> function).</li>
<li>Use <strong>verbs for functions, nouns for classes</strong>.</li>
<li>Use <strong>affirmative phrases for booleans</strong> (e.g., <code>is_visible</code> instead of <code>is_invisible</code>).</li>
<li>Use <strong>plurals for collections</strong> (e.g., <code>cats</code> instead of <code>list_of_cats</code>).</li>
<li><strong>Avoid encoding types in names</strong> (e.g., <code>sample_array</code>), since if you decide to change the data type later, you either need to rename the variable everywhere or the name is now misleading.</li>
<li><strong>Use AI to generate naming suggestions</strong> by describing the concept you’re trying to represent and asking for a suitable name.</li>
</ul>
</div>
</div>
</section>
</section>
<section id="testing" class="level2">
<h2 class="anchored" data-anchor-id="testing">Testing</h2>
<p>We all want our code to be correct. During development, we often verify this manually by running the code with example inputs to check if the output matches our expectations. While this approach helps to ensure correctness initially, it becomes cumbersome to recreate these test cases later when the code needs changes. The simple solution? <strong>Package your manual tests into a reusable test suite</strong> that you can run anytime to check your code for errors.</p>
<p>Tests typically use <code>assert</code> statements to confirm that the actual output matches the expected output. For example:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> add(x, y):</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> test_add():</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># verify correctness with examples, including edge cases</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># syntax: assert (expression that should be True), "error message"</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> add(<span class="dv">2</span>, <span class="dv">2</span>) <span class="op">==</span> <span class="dv">4</span>, <span class="st">"2 + 2 should equal 4"</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> add(<span class="dv">5</span>, <span class="op">-</span><span class="dv">6</span>) <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>, <span class="st">"5 - 6 should equal -1"</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> add(<span class="op">-</span><span class="dv">2</span>, <span class="fl">10.6</span>) <span class="op">==</span> <span class="fl">8.6</span>, <span class="st">"-2 + 10.6 should equal 8.6"</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> add(<span class="dv">0</span>, <span class="dv">0</span>) <span class="op">==</span> <span class="dv">0</span>, <span class="st">"0 + 0 should equal 0"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="callout callout-style-default callout-tip callout-titled" title="Testing in Python with `pytest`">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Testing in Python with <code>pytest</code>
</div>
</div>
<div class="callout-body-container callout-body">
<p>Consider using the <a href="https://docs.pytest.org/en/stable/"><code>pytest</code></a> framework for your Python tests. Organize all your test scripts in a dedicated <code>tests/</code> folder to keep them separate from the main source code.</p>
</div>
</div>
<p>As discussed in <a href="03_state_flow_how.html" class="quarto-xref"><span>Chapter 3</span></a>, <strong>pure functions</strong>—those without side effects like reading or writing external files—are especially <strong>easy to test</strong> because you can directly supply the necessary inputs. Placing your main logic into pure functions therefore simplifies testing the critical parts of your code. For impure functions, such as those interacting with databases or APIs, you can use techniques like <strong>mocking</strong> to simulate external resources, ideally combined with <strong>dependency injection</strong>.</p>
<p>When designing your tests, focus on <strong>edge cases</strong>—unusual or extreme scenarios like values outside the normal range or invalid inputs (e.g., dividing by zero or passing an empty list). The more thorough your tests, the more confident you can be in your code. Each time you make significant changes, run all your tests to ensure the code still behaves as expected.</p>
<p>Some developers even adopt <strong>Test-Driven Development (TDD)</strong>, where they write tests before the actual code. The process begins with writing tests that fail (or don’t even compile), then creating the code to make them pass. TDD can be highly motivating as it provides clear goals, but it requires discipline and may not always be practical in the early stages of development when function definitions are still evolving.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Testing at different levels">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Testing at different levels
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ideally, you’ll test your software at all levels:</p>
<ul>
<li><strong>Unit tests:</strong> Test individual units (e.g., single functions) to verify basic logic. These should make up the bulk of your test code.</li>
<li><strong>Integration/system tests:</strong> Check that different parts of the system work together as expected. These often require more complex setups, like running multiple services at the same time, to test the flow end-to-end.</li>
<li><strong>Manual testing:</strong> Identify unexpected behavior or overlooked edge cases. <strong><em>Whenever a bug is found, create an automated test to reproduce it and prevent regression.</em></strong></li>
<li><strong>User testing:</strong> Evaluate the user interface (UI) with real users to ensure clarity and usability. UX designers often perform these tests using design mockups before coding begins.</li>
</ul>
</div>
</div>
</section>
<section id="debugging" class="level2">
<h2 class="anchored" data-anchor-id="debugging">Debugging</h2>
<p>When your code doesn’t work as intended, you need to debug: <strong>systematically identify and fix the problem</strong>. Debugging becomes easier if your code is organized into small, testable functions covered by unit tests. These tests often help narrow down the source of the issue. If your existing tests didn’t catch the bug, <strong>first write a new, failing test to reproduce it</strong> before fixing it. This confirms your fix works and prevents a regression—meaning the bug won’t sneak back into the code later.</p>
<p>To isolate the exact line causing the error:</p>
<ul>
<li>Use <code>print</code> statements to log variable values at key points and understand the program’s flow.</li>
<li>Add <code>assert</code> statements to verify intermediate results.</li>
<li>Use a <strong>debugger</strong>, often integrated into your IDE, to set breakpoints where execution will pause, allowing you to step through the program manually and inspect variables.</li>
</ul>
<p>Debugging is an essential skill, not only to identify the root cause of bugs, but also to improve your understanding of the code and its behavior.</p>
</section>
<section id="optimizing-performance" class="level2">
<h2 class="anchored" data-anchor-id="optimizing-performance">Optimizing Performance</h2>
<blockquote class="blockquote">
<p><em>Make it run, make it right, make it fast.</em><br>
– Kent Beck (or rather his dad, Douglas Kent Beck<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>)</p>
</blockquote>
<p>Now that your code works and produces the right results (as you’ve dutifully confirmed with thorough testing), it’s time to think about performance.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Readability over performance">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Readability over performance
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Always prioritize writing code that’s easy to understand.</strong> Performance optimizations should not come at the cost of readability. More time is spent by humans reading and maintaining code than machines executing it.</p>
</div>
</div>
<section id="find-and-fix-the-bottlenecks" class="level4">
<h4 class="anchored" data-anchor-id="find-and-fix-the-bottlenecks">Find and Fix the Bottlenecks</h4>
<p>Instead of randomly trying to speed up everything, focus on the parts of your code that are actually slow. A simple way to identify bottlenecks is to insert log statements with timestamps at key points in your code to measure the time elapsed between steps. And if you manually interrupt a (Python) script during a long run and it always stops in the same place, that’s also often an indication that this step could be the issue. For a more systematic approach, use a <strong>profiler</strong>. Profilers analyze your code and show you how much time each part takes, helping you decide where to focus your efforts.</p>
<p><strong>Accessing files on disk or fetching data over the network</strong> is one of the slowest operations in most programs. Whenever possible, <strong>cache the results</strong> by storing the loaded data in memory to avoid repeated access to external resources. Just be mindful of how frequently the external data changes and invalidate the cache when the information becomes outdated.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Run it in the cloud">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Run it in the cloud
</div>
</div>
<div class="callout-body-container callout-body">
<p>Working with large datasets may trigger <code>Out of Memory</code> errors as your computer runs out of RAM. While optimizing your code can help, sometimes the quickest solution is to run it on a larger machine in the cloud. Platforms like AWS, Google Cloud, Azure, or your institution’s own compute cluster make this cost-effective and accessible. That said, always look for simple performance improvements first!</p>
</div>
</div>
</section>
<section id="think-about-big-o" class="level4">
<h4 class="anchored" data-anchor-id="think-about-big-o">Think About Big O</h4>
<p>Some computations have unavoidable limits. For example, finding the maximum value in an unsorted list requires checking every item—there is no way around this. The “Big O” notation is used to describe these limits, helping you understand how your code scales as data grows (both in terms of execution time and required memory).</p>
<ul>
<li><strong>Constant time</strong> (<span class="math inline">\(\mathcal{O}(1)\)</span>): Independent of dataset size (e.g., looking up a key in a dictionary).</li>
<li><strong>Linear time</strong> (<span class="math inline">\(\mathcal{O}(n)\)</span>): Grows proportionally to data size (e.g., finding the maximum in a list).</li>
<li><strong>Problematic growth</strong> (e.g., <span class="math inline">\(\mathcal{O}(n^3)\)</span> or <span class="math inline">\(\mathcal{O}(2^n)\)</span>): Polynomial or exponential scaling can make algorithms impractical for large datasets.</li>
</ul>
<p>When developing a novel algorithm, you should <strong>examine its scaling behavior both theoretically (e.g., using proofs) and empirically (e.g., timing it on datasets of different sizes)</strong>. Designing a more efficient algorithm is a major achievement in computational research!</p>
</section>
<section id="divide-conquer" class="level4">
<h4 class="anchored" data-anchor-id="divide-conquer">Divide &amp; Conquer</h4>
<p>If your code is too slow or your dataset too large, try <strong>splitting the work into smaller, independent chunks and combining the results</strong>. Such a “divide and conquer” approach is used in many algorithms, like the <a href="https://en.wikipedia.org/wiki/Merge_sort">merge sort algorithm</a>, and in big data frameworks like MapReduce.</p>
<section id="example-mapreduce" class="level5">
<h5 class="anchored" data-anchor-id="example-mapreduce">Example: MapReduce</h5>
<p>MapReduce <span class="citation" data-cites="dean2008mapreduce">[<a href="references.html#ref-dean2008mapreduce" role="doc-biblioref">2</a>]</span> was one of the first frameworks developed to work with ‘big data’ that does not fit on a single computer anymore. The data is split into chunks and distributed across multiple machines, where each chunk is processed in parallel (<em>map</em> step), and then the results are combined into the final output (<em>reduce</em> step).</p>
<p>For instance, if you want to train a machine learning model on a very large dataset, you could train separate models on subsets of the data and then aggregate their predictions (e.g., by averaging them), thereby creating an ensemble model.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Replace for-loops with map/filter/reduce">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Replace for-loops with map/filter/reduce
</div>
</div>
<div class="callout-body-container callout-body">
<p>Sequential <code>for</code> loops can often be replaced with <code>map</code>, <code>filter</code>, and <code>reduce</code> operations for better readability and potential parallelism:</p>
<ul>
<li><strong><code>map</code></strong>: Transform each element in a sequence.</li>
<li><strong><code>filter</code></strong>: Keep elements that meet a condition.</li>
<li><strong><code>reduce</code></strong>: Aggregate elements recursively (e.g., summing values).</li>
</ul>
<p>For example:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> functools <span class="im">import</span> <span class="bu">reduce</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">### Simplify this loop:</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>result_sum <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>result_max <span class="op">=</span> <span class="op">-</span><span class="bu">float</span>(<span class="st">'inf'</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10000</span>):</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    new_i <span class="op">=</span> i<span class="op">**</span><span class="fl">0.5</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># modulo operator x % y gives the remainder when diving x by y</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># i.e., we check for even numbers, where the rest is == 0</span></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="bu">round</span>(new_i) <span class="op">%</span> <span class="dv">2</span>) <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>        result_sum <span class="op">+=</span> new_i</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>        result_max <span class="op">=</span> <span class="bu">max</span>(result_max, new_i)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a><span class="co">### Using map/filter/reduce:</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a><span class="co"># map(function to apply, list of elements)</span></span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>new_i_all <span class="op">=</span> <span class="bu">map</span>(<span class="kw">lambda</span> x: x<span class="op">**</span><span class="fl">0.5</span>, <span class="bu">range</span>(<span class="dv">10000</span>))</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="co"># filter(function that returns true or false, list of elements)</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>new_i_filtered <span class="op">=</span> <span class="bu">filter</span>(<span class="kw">lambda</span> x: (<span class="bu">round</span>(x) <span class="op">%</span> <span class="dv">2</span>) <span class="op">==</span> <span class="dv">0</span>, new_i_all)</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce(function to combine current result with next element,</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="co">#        list of elements, initial value)</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>result_sum <span class="op">=</span> <span class="bu">reduce</span>(<span class="kw">lambda</span> acc, x: acc <span class="op">+</span> x, new_i_filtered, <span class="dv">0</span>)</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>result_max <span class="op">=</span> <span class="bu">reduce</span>(<span class="kw">lambda</span> acc, x: <span class="bu">max</span>(acc, x),</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>                    new_i_filtered, <span class="op">-</span><span class="bu">float</span>(<span class="st">'inf'</span>))</span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a><span class="co"># (of course, here we could've just used sum() and max() on the list)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In Python, list comprehensions also offer concise alternatives:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>new_i_filtered <span class="op">=</span> [i<span class="op">**</span><span class="fl">0.5</span> <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10000</span>)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                         <span class="cf">if</span> (<span class="bu">round</span>(i<span class="op">**</span><span class="fl">0.5</span>) <span class="op">%</span> <span class="dv">2</span>) <span class="op">==</span> <span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
</section>
<section id="exploit-parallelism" class="level4">
<h4 class="anchored" data-anchor-id="exploit-parallelism">Exploit Parallelism</h4>
<p>Many scientific computations are “<strong>embarrassingly parallelizable</strong>,” meaning tasks can run independently. For example, running simulations with different model configurations, initial conditions, or random seeds. Each of these experiments can be submitted as a separate job and run in parallel on a compute cluster. By identifying parts of your code that can be parallelized, you can save time and make full use of available resources.</p>
</section>
</section>
<section id="sec-refactoring" class="level2">
<h2 class="anchored" data-anchor-id="sec-refactoring">Refactoring</h2>
<p>Refactoring is the process of <strong>modifying existing code without altering its external behavior</strong> <span class="citation" data-cites="fowler2018refactoring">[<a href="references.html#ref-fowler2018refactoring" role="doc-biblioref">4</a>]</span>. In other words, it preserves the “contract” (interface) between your code and its users while improving its internal structure.<br>
Common refactoring tasks include:</p>
<ul>
<li><strong>Renaming</strong>: Giving (internally used) variables, functions, or classes more meaningful and descriptive names.</li>
<li><strong>Extracting functions</strong>: Breaking large functions into smaller, more focused ones (with a <strong>single responsibility</strong>).</li>
<li><strong>Eliminating duplication</strong>: Consolidating repeated code into reusable functions (<strong>DRY</strong> principle).</li>
<li><strong>Simplifying logic</strong>: Reducing deeply nested code structures or introducing guard clauses for clarity.</li>
<li><strong>Reorganizing code</strong>: Grouping related functions or classes into appropriate files or modules.</li>
</ul>
<section id="why-refactor" class="level4">
<h4 class="anchored" data-anchor-id="why-refactor">Why Refactor?</h4>
<p>Refactoring is typically done for two main reasons:</p>
<ol type="1">
<li><strong>Addressing technical debt</strong>:<br>
When code is written quickly—often to meet deadlines—it may include shortcuts that make future changes harder. This accumulation of compromises is called “technical debt.” Refactoring cleans up this debt, improving code quality and making the code easier to understand.
<ul>
<li>Example: Revisiting old code can be like tidying up a messy campsite. Just as a good scout leaves the campground cleaner than they found it, a responsible developer leaves the codebase better for the next person (or themselves in the future).</li>
</ul></li>
<li><strong>Making change easier</strong>:<br>
Sometimes, implementing a new feature in your existing code feels like forcing a square peg into a round hole. Instead of struggling with awkward workarounds, you should first refactor your code to align with the new requirements. The goal of software design isn’t to predict every possible future change (which is impossible) but to adapt gracefully when those changes arise. This promotes an evolutionary architecture, where you solve problems once you understand them better <span class="citation" data-cites="ford2022building">[<a href="references.html#ref-ford2022building" role="doc-biblioref">3</a>]</span>.
<ul>
<li>Before adding a new feature, clean up your code so that the change feels natural and seamless. This not only simplifies the task at hand but also results in more general, reusable functions and classes.</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-tip callout-titled" title="Tips when refactoring">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tips when refactoring
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li><strong>Test as you refactor</strong>: Always run tests before and after refactoring to ensure no functionality is accidentally broken. Writing or expanding automated tests is often part of the process to safeguard against regressions.</li>
<li><strong>Leverage IDE support</strong>: Modern IDEs like PyCharm or Visual Studio Code provide tools for automated refactoring, such as renaming, extracting functions, or moving files. These can save time and reduce errors.</li>
<li><strong>Avoid over-refactoring</strong>: While cleaning up code is valuable, avoid making unnecessary changes that don’t improve functionality or clarity. Over-refactoring wastes time and can confuse collaborators.</li>
</ul>
</div>
</div>
</section>
<section id="refactorings-to-simplify-changes" class="level4">
<h4 class="anchored" data-anchor-id="refactorings-to-simplify-changes">Refactorings to Simplify Changes</h4>
<blockquote class="blockquote">
<p><em>For each desired change, make the change easy (warning: this may be hard), then make the easy change.</em><br>
– Kent Beck<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
</blockquote>
<ul>
<li><p><strong>Replace magic numbers with constants</strong>: Magic numbers—values with unclear meaning—can make code harder to understand and maintain. By replacing them with constants, you create a single source of truth that’s easy to modify.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># before:</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> status <span class="op">==</span> <span class="dv">404</span>:</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co"># after:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>ERROR_NOT_FOUND <span class="op">=</span> <span class="dv">404</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> status <span class="op">==</span> ERROR_NOT_FOUND:</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You can also use enumerations to specify a set of related constants. Enums can be especially helpful to <strong>make a function’s interface explicit</strong>. For example, by specifying that an input argument should be an <code>HTTPStatus</code>, users of the function know that they can’t just pass any arbitrary integer:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> enum <span class="im">import</span> Enum</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> HTTPStatus(Enum):</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    OK <span class="op">=</span> <span class="dv">200</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    CREATED <span class="op">=</span> <span class="dv">201</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    FORBIDDEN <span class="op">=</span> <span class="dv">403</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    NOT_FOUND <span class="op">=</span> <span class="dv">404</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    INTERNAL_SERVER_ERROR <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    SERVICE_UNAVAILABLE <span class="op">=</span> <span class="dv">503</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_status_message(s: HTTPStatus):</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Returns the HTTP status message for a HTTPStatus enum</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>s<span class="sc">.</span>name<span class="sc">.</span>replace(<span class="st">'_'</span>, <span class="st">' '</span>)<span class="sc">.</span>title()<span class="sc">}</span><span class="ss"> (</span><span class="sc">{</span>s<span class="sc">.</span>value<span class="sc">}</span><span class="ss">)"</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="va">__name__</span> <span class="op">==</span> <span class="st">"__main__"</span>:</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Output: "Ok (200)" and "Not Found (404)"</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(get_status_message(HTTPStatus.OK))</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(get_status_message(HTTPStatus.NOT_FOUND))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Don’t Repeat Yourself (DRY)</strong>: Copying and pasting code may seem like a quick fix, but it leads to problems later. If the logic changes, you’ll need to update it everywhere it’s duplicated, which is error-prone. Instead, move the logic into a reusable function or method.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># before:</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (model.a <span class="op">&gt;</span> <span class="dv">5</span>) <span class="kw">and</span> (model.b <span class="op">==</span> <span class="dv">3</span>) <span class="kw">and</span> (model.c <span class="op">&lt;</span> <span class="dv">8</span>):</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    ...</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># after:</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> MyModel:</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> is_ready(<span class="va">self</span>):</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> (<span class="va">self</span>.a <span class="op">&gt;</span> <span class="dv">5</span>) <span class="kw">and</span> (<span class="va">self</span>.b <span class="op">==</span> <span class="dv">3</span>) <span class="kw">and</span> (<span class="va">self</span>.c <span class="op">&lt;</span> <span class="dv">8</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> model.is_ready():</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    ...</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Implement wrappers</strong>: When working with external libraries or APIs, their provided interface might not align with your needs, and adapting to it directly can lead to awkward implementations in your code. A better solution is to create a wrapper that implements <strong>the interface you wish you had</strong>, translating the external API’s inputs and outputs into the format that best suits your implementation. This approach keeps your code clean, consistent, and easier to maintain, while confining the less-than-ideal API interactions to a single location. Plus, if the external API changes, you only need to update the wrapper instead of changing your code everywhere—which is why these wrappers are also called <em>anti-corruption layers</em>.</p></li>
<li><p><strong>Use alternative constructors</strong>: Similar to a wrapper, you can add a class method to create objects in a way that’s different from the regular constructor. This is useful when the input data doesn’t directly match what the constructor needs. For instance, imagine you have a configuration file that specifies settings for a simulation. If the names or structure of these settings don’t match the constructor’s parameters, you can create a <code>from_config</code> method to handle the translation and then call the constructor with the correct arguments. The advantage is that if the format of the configuration file changes in the future, you only need to update this one method, keeping the rest of your code the same.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> Date:</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, year, month, day):</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.year <span class="op">=</span> year</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.month <span class="op">=</span> month</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span>.day <span class="op">=</span> day</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">@classmethod</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> from_str(cls, date_str):</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>      <span class="co"># parse the string and create a new instance</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>      year, month, day <span class="op">=</span> <span class="bu">map</span>(<span class="bu">int</span>, date_str.split(<span class="st">'-'</span>))</span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>      <span class="cf">return</span> cls(year, month, day)</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="co"># usage:</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>date1 <span class="op">=</span> Date(<span class="dv">2025</span>, <span class="dv">0</span><span class="er">1</span>, <span class="dv">30</span>)</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>date2 <span class="op">=</span> Date.from_str(<span class="st">"2025-01-30"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p><strong>Organize for cohesion</strong>: Keep code elements that need to change together in the same file or module. Conversely, separate unrelated parts of your code to prevent unnecessary entanglement. This way, changes are localized, which reduces cognitive load.</p>
<p>In larger codebases shared by multiple teams, this is even more critical. <strong>When changes require excessive communication and coordination between teams, it signals a need to reorganize the code.</strong> Clear ownership and reduced dependencies help teams work independently by making sure the system is loosely coupled through agreed upon interfaces.</p></li>
</ul>
</section>
<section id="large-scale-refactoring" class="level4">
<h4 class="anchored" data-anchor-id="large-scale-refactoring">Large-scale Refactoring</h4>
<p>While smaller portions of code are often tidied up as you go <span class="citation" data-cites="beck2023tidy">[<a href="references.html#ref-beck2023tidy" role="doc-biblioref">1</a>]</span>, larger refactorings that span multiple files or repositories require more upfront planning <span class="citation" data-cites="lemaire2020refactoring lilienthal2019sustainable lilienthal2023ddt">[<a href="references.html#ref-lemaire2020refactoring" role="doc-biblioref">5</a>,<a href="references.html#ref-lilienthal2019sustainable" role="doc-biblioref">6</a>,<a href="references.html#ref-lilienthal2023ddt" role="doc-biblioref">7</a>]</span>.</p>
<p>The following steps will help keep larger refactorings on track and ensure they deliver real improvements:</p>
<ol type="1">
<li><p><strong>Identify the problems this refactoring should address.</strong></p>
<p>Don’t refactor just because the code is <em>ugly</em>—refactor because it’s <strong>causing problems</strong>. For example, the current structure may make it difficult to implement important new features or maintain the code efficiently. <strong>List all the problems</strong> the code creates and <strong>rank them by severity</strong> to ensure your refactoring tackles the most critical issues.</p></li>
<li><p><strong>Envision the ideal state.</strong></p>
<p>Code can become suboptimal for many reasons. Maybe a looming deadline forced developers to take shortcuts, leading to <strong>technical debt</strong>. Maybe an inexperienced developer made a <strong>design choice that no longer fits</strong>. But most likely, the <strong>requirements have evolved</strong> since the code was written, making what was once a good solution no longer suitable.</p>
<p>Try to break free from the existing structure and its limitations. If you were <strong>designing the system from scratch today</strong>, given everything you now know about <strong>current and future requirements</strong>, what would you build? What should the code look like once refactored?</p></li>
<li><p><strong>Verify that the ideal state solves the most important issues.</strong></p>
<p>Revisit your <strong>list of problems</strong> and ensure that your envisioned ideal state actually <strong>addresses them</strong>. If necessary, <strong>iterate on your vision</strong> until you have a solution that tackles the most critical challenges. This gives you a better understanding of which changes to the codebase are actually necessary to achieve your goal.</p></li>
<li><p><strong>Make a realistic plan to get closer to your ideal state.</strong></p>
<p>While it might be tempting to <strong>rewrite everything from scratch</strong>, this is rarely practical. A complete rewrite would likely take longer than expected and introduce <strong>new, unforeseen issues</strong>, as the existing code likely accounts for edge cases and hidden requirements you’ve forgotten.</p>
<p>Instead, <strong>translate your ideal state into small, targeted changes</strong> to the existing codebase that still provide <strong>significant benefits</strong>. Ideally, each change should:</p>
<ul>
<li>Be <strong>independent</strong> of the others, allowing for <strong>incremental progress</strong>.</li>
<li>Deliver <strong>some immediate value</strong> on its own.</li>
</ul>
<p>Create a <strong>prioritized list of independent changes</strong>, considering both:</p>
<ul>
<li><strong>Impact:</strong> Which of the original problems does this change solve?</li>
<li><strong>Effort:</strong> How difficult would this be to implement? What dependencies or additional steps are required (e.g., database migrations, external system changes, or involvement from other teams)?</li>
</ul>
<p>To accurately assess effort, <strong>detail your plan</strong>—outline <strong>which files and functions will be affected</strong> and identify any external dependencies. Once you’ve evaluated <strong>impact vs.&nbsp;effort</strong>, decide <strong>which changes are essential</strong>, which are nice-to-have, and which might not be worth the effort, while taking into account that some steps might depend on the successful completion of other changes.</p></li>
<li><p><strong>Get feedback on your plan.</strong></p>
<p>If possible, <strong>discuss your plan with collaborators and stakeholders</strong>—especially those affected by the changes. They might <strong>catch overlooked dependencies</strong> or <strong>identify potential blockers</strong> before you run into them during implementation.</p></li>
<li><p><strong>Execute incrementally and merge frequently.</strong></p>
<p>Instead of implementing all changes at once, <strong>work step by step, merging updates back into the codebase as quickly as possible</strong>. This minimizes risk, ensures early <strong>testing and validation</strong>, and helps maintain motivation—since every small change delivers <strong>immediate value</strong>.</p></li>
</ol>
<p>By refactoring regularly and following these practices, you’ll create a cleaner, more maintainable codebase that is adaptable to future needs and enjoyable to work with.</p>
<div class="callout callout-style-default callout-caution callout-titled" title="Before you continue">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Before you continue
</div>
</div>
<div class="callout-body-container callout-body">
<p>At this point, you should have a clear understanding of:</p>
<ul>
<li>How to transform your concept into code.</li>
<li>Some best practices to make sure your code works well—now and in the future.</li>
</ul>
</div>
</div>


<div id="refs" class="references csl-bib-body" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-beck2023tidy" class="csl-entry" role="listitem">
<div class="csl-left-margin">[1] </div><div class="csl-right-inline">Beck K. <em>Tidy First?</em> O’Reilly Media, Inc. (2023).</div>
</div>
<div id="ref-dean2008mapreduce" class="csl-entry" role="listitem">
<div class="csl-left-margin">[2] </div><div class="csl-right-inline">Dean J, Ghemawat S. MapReduce: Simplified Data Processing on Large Clusters. <em>Communications of the ACM</em> 51(1), 107–113 (2008).</div>
</div>
<div id="ref-ford2022building" class="csl-entry" role="listitem">
<div class="csl-left-margin">[3] </div><div class="csl-right-inline">Ford N, Parsons R, Kua P, Sadalage P. <em>Building Evolutionary Architectures</em>. O’Reilly Media, Inc. (2022).</div>
</div>
<div id="ref-fowler2018refactoring" class="csl-entry" role="listitem">
<div class="csl-left-margin">[4] </div><div class="csl-right-inline">Fowler M. <em>Refactoring: Improving the Design of Existing Code</em>. Addison-Wesley Professional (2018).</div>
</div>
<div id="ref-lemaire2020refactoring" class="csl-entry" role="listitem">
<div class="csl-left-margin">[5] </div><div class="csl-right-inline">Lemaire M. <em>Refactoring at Scale</em>. O’Reilly Media, Inc. (2020).</div>
</div>
<div id="ref-lilienthal2019sustainable" class="csl-entry" role="listitem">
<div class="csl-left-margin">[6] </div><div class="csl-right-inline">Lilienthal C. <em>Sustainable Software Architecture: Analyze and Reduce Technical Debt</em>. dpunkt.verlag (2019).</div>
</div>
<div id="ref-lilienthal2023ddt" class="csl-entry" role="listitem">
<div class="csl-left-margin">[7] </div><div class="csl-right-inline">Lilienthal C, Schwentner H. <em>Domain-Driven Transformation: Monolithen Und Microservices Zukunftsfähig Machen</em>. dpunkt.verlag (2023).</div>
</div>
<div id="ref-ousterhout2018philosophy" class="csl-entry" role="listitem">
<div class="csl-left-margin">[8] </div><div class="csl-right-inline">Ousterhout JK. <em>A Philosophy of Software Design</em>. Yaknyam Press Palo Alto, CA, USA (2018).</div>
</div>
</div>
</section>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>https://martinfowler.com/bliki/TwoHardThings.html<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>https://x.com/KentBeck/status/704385198301904896<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>https://x.com/KentBeck/status/250733358307500032<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script type="text/javascript"> // go once over all images and transform the percentage width into pixels relative to original body size
  const bodyWidth = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--custom-body-width')); // Get CSS variable
  document.querySelectorAll('.quarto-figure img').forEach((img) => {
    if (img.getAttribute('style')) {
      const styleWidth = img.getAttribute('style').match(/width:\s*([\d.]+)%/); // Extract percentage
      if (styleWidth) {
        const percentage = parseFloat(styleWidth[1]) / 100;
        if (percentage < 1) {
          percentage *= 0.87  // had to increase image width for pdf
        }
        img.style.width = `${bodyWidth * percentage}px`; // Apply calculated width
      }
    }
  });
</script>

<style type="text/css">
#footer {
  font-size: 80%; /* Makes the font 70% smaller */
  border-top: 1px solid #ccc; /* Adds a horizontal line above the footer */
  padding-top: 10px; /* Adds some spacing above the footer content */
}
</style>

<!-- FOOTER  -->
<div id="footer" class="outer">
  <footer class="inner">
    <p>Find me on <a href="https://github.com/cod3licious/" target="_blank" rel="nofollow">GitHub</a> and <a href="https://www.linkedin.com/in/franziska-horn/" target="_blank" rel="nofollow">LinkedIn</a><br>
      <a href="https://franziskahorn.de/">Home</a> ~ <a href="mailto:hey@franziskahorn.de?Subject=Book%20Feedback" target="_blank" rel="nofollow">Contact</a> ~ <a href="https://franziskahorn.de/impressum.html">Impressum</a></p>

      <!-- CC license -->
    <p xmlns:cc="http://creativecommons.org/ns#">This work is licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/?ref=chooser-v1" target="_blank" rel="license noopener noreferrer" style="display:inline-block;">CC BY-NC-ND 4.0<img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/cc.svg?ref=chooser-v1" alt=""><img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/by.svg?ref=chooser-v1" alt=""><img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nc.svg?ref=chooser-v1" alt=""><img style="height:16px!important;margin-left:3px;vertical-align:text-bottom;" src="https://mirrors.creativecommons.org/presskit/icons/nd.svg?ref=chooser-v1" alt=""></a></p>
  </footer>
</div>
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./04_tools.html" class="pagination-link" aria-label="Tools">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Tools</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./06_from_research_to_production.html" class="pagination-link" aria-label="From Research to Production">
        <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">From Research to Production</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>